# language: ja

@US1
フィーチャ: 構文木の走査
    ライブラリ利用者として、
    AsciiDoc 文書の構文木を走査し、
    各ノードを訪問して処理を行いたい

    背景:
        前提 AsciiDoc パーサーが初期化されている

    @Acceptance @Scenario1
    シナリオ: Visitor で全ノードを走査する
        前提 以下の AsciiDoc 文書がある:
            """
            = タイトル

            段落テキスト
            """
        もし 文書を解析する
        かつ 全ノードを訪問する Visitor で走査する
        ならば すべてのノードが訪問される
        # Document, Header, SectionTitle, Body, Paragraph の 5 ノード
        かつ 訪問されたノード数は 5 である

    @Acceptance @Scenario2
    シナリオ: Visitor でリンクノードのみを処理する
        前提 以下の AsciiDoc 文書がある:
            """
            = タイトル

            https://example.com[リンク1] と https://example.org[リンク2] を含む段落
            """
        もし 文書を解析する
        かつ リンクを収集する Visitor で走査する
        ならば 収集されたリンク数は 2 である

    @Acceptance @Scenario3
    シナリオ: Visitor でセクションタイトルを収集する
        前提 以下の AsciiDoc 文書がある:
            """
            = ドキュメントタイトル

            == セクション1

            段落1

            == セクション2

            段落2
            """
        もし 文書を解析する
        かつ セクションタイトルを収集する Visitor で走査する
        ならば 収集されたセクションタイトル数は 2 である
        かつ セクションタイトルは順番に "セクション1", "セクション2" である

    @EdgeCase
    シナリオ: 空の文書を走査する
        前提 以下の AsciiDoc 文書がある:
            """
            """
        もし 文書を解析する
        かつ 全ノードを訪問する Visitor で走査する
        ならば エラーなく走査が完了する
        # Document, Body の 2 ノード
        かつ 訪問されたノード数は 2 である

    @EdgeCase
    シナリオ: Visitor で例外が発生した場合に伝播する
        前提 以下の AsciiDoc 文書がある:
            """
            = タイトル

            段落テキスト
            """
        もし 文書を解析する
        かつ 例外を投げる Visitor で走査する
        ならば 例外が伝播する

    @EdgeCase
    シナリオ: 欠落ノードを含む構文木を走査する
        前提 以下の不完全な AsciiDoc 文書がある:
            """
            =
            """
        もし 文書を解析する
        かつ 全ノードを訪問する Visitor で走査する
        ならば 欠落ノードも訪問される

    # US2: 結果を返す走査
    @US2 @Acceptance
    シナリオ: 結果を返す Visitor で目次を生成する
        前提 以下の AsciiDoc 文書がある:
            """
            = ドキュメントタイトル

            == セクション1

            段落1

            === サブセクション1-1

            段落2

            == セクション2

            段落3
            """
        もし 文書を解析する
        かつ 結果を返す Visitor で目次を生成する
        ならば 目次項目数は 3 である
        かつ 目次の階層構造が正しい

    @US2 @Acceptance
    シナリオ: 結果を返す Visitor でプレーンテキストを抽出する
        前提 以下の AsciiDoc 文書がある:
            """
            = タイトル

            https://example.com[リンクテキスト] を含む段落
            """
        もし 文書を解析する
        かつ 結果を返す Visitor でプレーンテキストを抽出する
        # リンクの表示テキストが抽出される
        ならば 抽出されたテキストに "リンクテキスト" が含まれる
