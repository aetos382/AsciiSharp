# language: ja

@US2 @エラー回復
フィーチャ: エラー耐性解析
    エディタ開発者として、
    構文エラーを含む AsciiDoc 文書を解析しても、
    正常な部分を最大限に解析し、有用な情報を提供したい

    背景:
        前提 AsciiDoc パーサーが利用可能である

    @Red @Acceptance
    シナリオ: 不完全なセクションタイトルを含む文書の解析
        前提 以下の AsciiDoc 文書がある:
            """
            = ドキュメントタイトル

            == セクション1

            これは正常な段落です。

            ==

            == セクション2

            これも正常な段落です。
            """
        もし 文書を解析する
        ならば 構文木が生成される
        かつ 構文木に診断情報が含まれる
        かつ 診断情報の数は 1 以上である
        かつ "セクション1" のセクションが正しく解析される
        かつ "セクション2" のセクションが正しく解析される

    @ignore @Acceptance
    シナリオ: 閉じられていない区切りブロックを含む文書の解析
        # 注: 区切りブロック（コードブロック等）は MVP スコープ外のため延期
        前提 以下の AsciiDoc 文書がある:
            """
            = ドキュメントタイトル

            == セクション1

            ----
            コードブロックの内容

            == セクション2

            正常な段落です。
            """
        もし 文書を解析する
        ならば 構文木が生成される
        かつ 構文木に診断情報が含まれる
        かつ "セクション2" が何らかの形で認識される

    @Red @Acceptance
    シナリオ: 正常部分の最大解析
        前提 以下の AsciiDoc 文書がある:
            """
            = タイトル

            == 正常セクション1

            正常な段落1。

            == [不正な属性

            不正なセクション。

            == 正常セクション2

            正常な段落2。
            """
        もし 文書を解析する
        ならば 構文木が生成される
        かつ 正常な段落の数は 2 以上である
        かつ 構文木からテキストを再構築できる

    @Red @Diagnostic
    シナリオ: 診断情報の位置情報が正確である
        前提 以下の AsciiDoc 文書がある:
            """
            = タイトル

            ==
            """
        もし 文書を解析する
        ならば 構文木に診断情報が含まれる
        かつ 診断情報に位置情報が含まれる
        かつ 診断情報の重大度が "Error" または "Warning" である

    @Red @MissingToken
    シナリオ: 欠落トークンの検出
        前提 以下の AsciiDoc 文書がある:
            """
            = タイトル

            ==

            段落テキスト。
            """
        もし 文書を解析する
        ならば 構文木が生成される
        かつ 構文木に欠落ノードが含まれる
        かつ 欠落ノードの IsMissing プロパティが true である

    @Red @SkippedTokens
    シナリオ: スキップされたトークンの保持
        前提 以下の AsciiDoc 文書がある:
            """
            = タイトル

            @@@不正なトークン@@@

            正常な段落。
            """
        もし 文書を解析する
        ならば 構文木が生成される
        かつ スキップされたトークンがトリビアとして保持される
        かつ 構文木からテキストを再構築できる
