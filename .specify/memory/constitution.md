<!--
Sync Impact Report:
- Version: 1.4.1 → 1.4.2
- 変更された原則: なし
- 追加されたセクション: なし
- 修正されたセクション:
  - VI. フェーズ順序の厳守: plan フェーズの「フィーチャ定義」を「LightBDD フィーチャー クラス」に具体化
  - BDD サイクル - Red: LightBDD での仕様先行手順を具体的に記述（シナリオ定義 + 未実装ステップ）
  - 開発ワークフロー: plan フェーズの説明を LightBDD に合わせて更新
- 削除されたセクション: なし
- テンプレート更新状況:
  - plan-template.md: ✅ 変更不要
  - spec-template.md: ✅ 変更不要
  - tasks-template.md: ✅ 変更不要
- フォローアップTODO: なし
-->

# AsciiSharp Constitution

## Core Principles

### I. コード品質ファースト

**必須事項**:
- すべてのコードは可読性を最優先とする
- メンテナンス性を確保するため、適切な命名規則と構造化を行う
- テスト可能性を考慮した設計を行う
- パフォーマンスを意識した実装を行う
- セキュリティベストプラクティスに従う
- 可観測性（ログ、メトリクス、トレース）を組み込む

**根拠**: 長期的なプロジェクトの成功には、コード品質の維持が不可欠である。品質を後回しにすると、技術的負債が蓄積し、開発速度が低下する。

### II. モジュール設計

**必須事項**:
- 適切な単位でプロジェクトを分割する
- 各モジュールは明確な責務を持つ
- モジュール間の依存関係を最小化する
- 再利用可能なコンポーネントとして設計する
- 疎結合・高凝集の原則に従う

**根拠**: モジュール化により、コードの再利用性、テスト容易性、並行開発が可能になる。適切な分割は、変更の影響範囲を限定し、保守性を向上させる。

### III. BDD必須 (NON-NEGOTIABLE)

**必須事項**:
- **明示的に指定した対象プロジェクト**の機能開発において Behavior Driven Development (BDD) を実施する
- Red-Green-Refactor サイクルを厳格に遵守する
- Given-When-Then 形式で振る舞いを記述する
- ユーザーストーリーから受け入れシナリオを導出する
- 実装前にテストを記述し、テストが失敗することを確認する

**BDD 対象プロジェクト**:
現時点で BDD を適用する対象プロジェクトは以下の通り:
- `Source/AsciiSharp/AsciiSharp.csproj` （コア ライブラリ）

上記以外のプロジェクト（Asg、TckAdapter 等）は、通常のユニット テストまたは外部検証（TCK テスト等）で品質を確保する。
対象プロジェクトの追加は、この憲章の改訂により明示的に指定する。

**根拠**: BDD は要件と実装の乖離を防ぎ、ビジネス価値とテストを直結させる。テストファーストにより、設計品質が向上し、リグレッションを防止できる。対象を明示的に指定することで、BDD の適用範囲を明確にし、過度な負担を避ける。

### IV. 継続的品質保証

**必須事項**:
- BDD の Green ステップ（テスト成功）後、必ずビルドとすべてのテストを実行する
- BDD の Refactoring ステップ後、必ずビルドとすべてのテストを実行する
- テストが失敗した場合、成功するまで修正を継続する
- すべてのコミット前にビルドとテストを実行する
- 継続的インテグレーション（CI）パイプラインを維持する

**根拠**: 継続的な検証により、問題の早期発見と迅速な修正が可能になる。自動化されたフィードバックループは、品質の一貫性を保証する。

### V. 警告ゼロポリシー

**必須事項**:
- BDD の Refactoring ステップ中に、すべてのコンパイラ警告とリンター警告を解消する
- 正当な理由がある場合のみ、明示的な抑制（suppression）を行う
- 抑制する場合は、コメントで理由を明記する
- 新しい警告が発生しないように、CI で警告をエラーとして扱う

**根拠**: 警告は潜在的な問題の兆候である。警告を放置すると、重要な問題が見逃される可能性がある。警告ゼロを維持することで、コードベースの健全性を保つ。

### VI. フェーズ順序の厳守 (NON-NEGOTIABLE)

**必須事項**:
- 機能開発は以下のフェーズ順序を厳守する:
  1. **specify**: 機能仕様の定義（`/speckit.specify`）
  2. **clarify**: 仕様の曖昧さを解消（`/speckit.clarify`）
  3. **plan**: 実装計画の策定と LightBDD フィーチャー クラスの作成（`/speckit.plan`）
  4. **tasks**: タスクリストの生成（`/speckit.tasks`）
  5. **analyze**: 品質・整合性の分析、テスト失敗確認（`/speckit.analyze`）
  6. **implement**: 実装の実行（`/speckit.implement`）
- BDD の Red ステップ（失敗するテストの作成）は **plan** フェーズで LightBDD フィーチャー クラス（シナリオ定義 + 未実装ステップ）を作成し、作成後すぐにテスト失敗を確認してよい
- BDD の Green/Refactor ステップは **implement** フェーズ中に行う
- フェーズをスキップしてはならない（ただし clarify は曖昧さがない場合は省略可）
- **各フェーズの終了時には必ずコミットを作成する**

**セッション中断時の再開**:
- チャットセッションが中断した場合、以下の情報から現在のフェーズを推測して再開する:
  - チャット履歴
  - 作成済みの文書（spec.md, plan.md, tasks.md 等）
  - コミットログ（フェーズ名が記載されている）
- フェーズが不明な場合は、ユーザーに問い合わせる

**根拠**: フェーズ順序を遵守することで、設計と実装の乖離を防ぎ、品質の一貫性を確保する。テストを先に書くことで、実装が要件を満たすことを保証できる。セッション中断時もフェーズを追跡可能にすることで、作業の継続性を担保する。

## 開発ワークフロー

### フェーズ順序

```
specify → clarify → plan → tasks → analyze → implement
   │         │        │       │        │          │
   │         │        │       │        │          └─ Green/Refactor
   │         │        │       │        └─ 整合性検証
   │         │        │       └─ タスク分解
   │         │        └─ 設計ドキュメント + LightBDD フィーチャー クラス作成 + Red 確認
   │         └─ 質問による曖昧さ解消
   └─ 仕様書作成
```

**フェーズの目的**:
- **specify**: ユーザーストーリーと受け入れ条件を定義
- **clarify**: 仕様の不明点を質問で解消
- **plan**: 技術調査、データモデル、APIコントラクト、**LightBDD フィーチャー クラス（シナリオ定義 + 未実装ステップ）**を策定し、テスト失敗を確認（Red）
- **tasks**: 実装タスクを依存関係順に分解
- **analyze**: 成果物の整合性を検証
- **implement**: テストを通す実装を行い（Green）、リファクタリング（Refactor）

### セッション継続性

**中断時の再開手順**:
1. 以下の情報源を確認してフェーズを特定:
   - コミットログ: `git log --oneline -10` でフェーズ名を確認
   - 文書の存在: `specs/[feature]/` 配下のファイル有無
   - チャット履歴: 最後に実行したコマンドを確認
2. フェーズが特定できた場合、そのフェーズの続きから再開
3. フェーズが不明な場合、ユーザーに確認を求める

**フェーズ特定の目安**:
| 存在する成果物 | 推定フェーズ |
|---------------|-------------|
| spec.md のみ | specify 完了 → clarify または plan |
| spec.md + plan.md | plan 完了 → tasks |
| spec.md + plan.md + tasks.md | tasks 完了 → analyze |
| 上記 + 実装コード（テスト失敗） | analyze 完了 → implement |

### BDD サイクル

1. **Red（レッド）**: 失敗するテストを書く
   - ユーザーストーリーから受け入れシナリオを作成
   - Given-When-Then 形式でテストケースを記述
   - LightBDD フィーチャー クラスを作成する:
     - シナリオ定義（`XxxFeature.cs`）: `[Scenario]` メソッドと `Runner.RunScenario(...)` でシナリオ構造を定義
     - ステップ実装（`XxxFeature.Steps.cs`）: ステップ メソッドの本体は空または `Assert.Inconclusive("未実装")` とする
   - テストを実行し、失敗することを確認
   - **タイミング**: **plan** フェーズで作成・確認（作成後すぐに Red 確認してよい）

2. **Green（グリーン）**: テストを通す最小限の実装
   - テストを成功させるコードを実装
   - 実装完了後、**必ずビルドとすべてのテストを実行**
   - すべてのテストが成功することを確認
   - **タイミング**: implement フェーズ中

3. **Refactor（リファクタリング）**: コードを改善
   - 重複を排除し、可読性を向上
   - 設計を改善
   - リファクタリング完了後、**必ずビルドとすべてのテストを実行**
   - すべての警告を解消または無効化
   - すべてのテストが成功することを確認
   - **タイミング**: implement フェーズ中

### コミットとプッシュ

**必須事項**:
- **タスク完了ごとにコミットを作成する**
- **各フェーズの終了時に必ずコミットを作成する**
- コミット作成には `/commit-commands:commit` コマンドを使用する
- コミット前に必ずビルドとテストを実行する
- コミットメッセージは日本語で明確に記述する

**コミットのタイミング**:
- 各タスク（T001, T002, ...）の完了時
- 各 BDD サイクル（Red → Green → Refactor）の完了時
- **各フェーズ（specify, clarify, plan, tasks, analyze）の完了時**
- 論理的にまとまった変更の完了時

**フェーズ終了時のコミットメッセージ形式**:
```
[phase: <フェーズ名>] <変更内容の要約>

例:
[phase: specify] ASG モデルの仕様書を作成
[phase: plan] ASG モデルの設計とフィーチャー クラスを追加
[phase: tasks] ASG モデルのタスクリストを生成
[phase: analyze] ASG モデルの整合性検証完了
```

**プッシュ**:
- プッシュ前に CI パイプラインの成功を確認する
- 複数のコミットをまとめてプッシュすることは許容される

## 品質ゲート

### ビルド成功

- すべてのプロジェクトがエラーなしでビルドできる
- 警告がゼロである（または正当な理由で抑制されている）

### テスト成功

- すべてのユニットテストが成功する
- すべての統合テストが成功する
- すべての受け入れテストが成功する
- テストカバレッジが維持または向上している

### コード品質

- コードレビューが完了している
- 静的解析ツールがパスしている
- セキュリティスキャンがパスしている
- パフォーマンステストが基準を満たしている

## Governance

### 憲章の位置づけ

- この憲章は、すべての開発プラクティスに優先する
- 憲章に違反する実装は、正当化されない限り却下される
- 複雑性の導入は、憲章の原則と照らし合わせて正当化が必要

### 改訂手順

1. 改訂提案を文書化
2. 影響分析を実施（影響を受けるコード、テンプレート、ワークフローを特定）
3. レビューと承認
4. バージョン番号を更新（セマンティックバージョニング）
   - MAJOR: 後方互換性のない変更、原則の削除または再定義
   - MINOR: 新しい原則またはセクションの追加、ガイダンスの大幅な拡張
   - PATCH: 明確化、文言修正、タイポ修正、非セマンティックな改善
5. 依存テンプレートと文書を更新
6. Sync Impact Report を作成

### コンプライアンス

- すべてのプルリクエストは、憲章への準拠を確認する
- コードレビューでは、憲章の原則を基準とする
- CI パイプラインで、品質ゲートを自動検証する
- 定期的に憲章の遵守状況をレビューする

---

**Version**: 1.4.2 | **Ratified**: 2026-01-18 | **Last Amended**: 2026-02-12
